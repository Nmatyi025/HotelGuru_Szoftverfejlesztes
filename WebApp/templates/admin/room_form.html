{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">
        {% if is_edit %}
        <i class="bi bi-pencil-square"></i> Edit Room {{ room.room_number }}
        {% else %}
        <i class="bi bi-plus-circle"></i> Add New Room
        {% endif %}
        <small class="text-muted">- {{ hotel.name }}</small>
    </h1>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label for="room_number" class="form-label">Room Number*</label>
                            <input type="text" class="form-control" id="room_number" name="room_number" 
                                   value="{{ room.room_number if room else '' }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="price_per_night" class="form-label">Price Per Night ($)*</label>
                            <input type="number" class="form-control" id="price_per_night" name="price_per_night" 
                                   min="0" step="0.01" value="{{ room.price_per_night if room else '' }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3">{{ room.description if room else '' }}</textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="photo_url" class="form-label">Photo URL</label>
                            <input type="text" class="form-control" id="photo_url" name="photo_url" 
                                   value="{{ room.photo_urls[0] if room and room.photo_urls else '' }}">
                            {% if room and room.photo_urls %}
                            <div class="mt-2">
                                <img src="{{ room.photo_urls[0] }}" 
                                     class="img-thumbnail" style="max-width: 200px" alt="Room {{ room.room_number }}">
                            </div>
                            {% endif %}
                        </div>
                        
                        {% if is_edit %}
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="available" name="available" 
                                   {% if room and room.available %}checked{% endif %}>
                            <label class="form-check-label" for="available">Room is available for booking</label>
                        </div>
                        {% endif %}
                        
                        <h5 class="mt-4 mb-3">Additional Services</h5>
                        <div id="services-container">
                            {% if room and room.additional_services %}
                                {% for service in room.additional_services %}
                                <div class="service-item card mb-3">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <h6 class="card-title">Service #{{ loop.index }}</h6>
                                            <button type="button" class="btn btn-sm btn-outline-danger remove-service">
                                                <i class="bi bi-x-lg"></i>
                                            </button>
                                        </div>
                                        <div class="row g-2">
                                            <div class="col-md-4 mb-2">
                                                <label class="form-label">Name*</label>
                                                <input type="text" class="form-control" name="service_name[]" 
                                                       value="{{ service.name }}" required>
                                            </div>
                                            <div class="col-md-6 mb-2">
                                                <label class="form-label">Description</label>
                                                <input type="text" class="form-control" name="service_description[]" 
                                                       value="{{ service.description }}">
                                            </div>
                                            <div class="col-md-2 mb-2">
                                                <label class="form-label">Price ($)</label>
                                                <input type="number" class="form-control" name="service_price[]" 
                                                       min="0" step="0.01" value="{{ service.price }}">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        
                        <button type="button" id="add-service" class="btn btn-outline-success mb-4">
                            <i class="bi bi-plus-circle"></i> Add Service
                        </button>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <a href="{{ url_for('admin_hotel_rooms', hotel_id=hotel.id) }}" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left"></i> Back to Rooms
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> 
                                {% if is_edit %}Update Room{% else %}Add Room{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card shadow-sm bg-light">
                <div class="card-body">
                    <h5 class="card-title">Tips</h5>
                    <ul class="small">
                        <li>All fields marked with * are required</li>
                        <li>Additional services can be free (price $0) or paid</li>
                        <li>A detailed description helps guests know what to expect</li>
                        <li>Photos should clearly show the room's features</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<template id="service-template">
    <div class="service-item card mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between">
                <h6 class="card-title">New Service</h6>
                <button type="button" class="btn btn-sm btn-outline-danger remove-service">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="row g-2">
                <div class="col-md-4 mb-2">
                    <label class="form-label">Name*</label>
                    <input type="text" class="form-control" name="service_name[]" required>
                </div>
                <div class="col-md-6 mb-2">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-control" name="service_description[]">
                </div>
                <div class="col-md-2 mb-2">
                    <label class="form-label">Price ($)</label>
                    <input type="number" class="form-control" name="service_price[]" min="0" step="0.01" value="0">
                </div>
            </div>
        </div>
    </div>
</template>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const addServiceBtn = document.getElementById('add-service');
        const servicesContainer = document.getElementById('services-container');
        const serviceTemplate = document.getElementById('service-template');
        
        addServiceBtn.addEventListener('click', function() {
            const serviceNode = document.importNode(serviceTemplate.content, true);
            servicesContainer.appendChild(serviceNode);
            
            updateRemoveButtons();
        });
        
        updateRemoveButtons();
        
        function updateRemoveButtons() {
            const removeButtons = document.querySelectorAll('.remove-service');
            removeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const serviceItem = this.closest('.service-item');
                    serviceItem.remove();
                });
            });
        }
    });
</script>
{% endblock %}